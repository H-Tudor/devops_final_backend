name: CI Pipeline

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.13"]

    steps:
      - uses: actions/checkout@v5

      - name: Install the latest version of uv and set the python version
        uses: astral-sh/setup-uv@v7
        with:
          python-version: ${{ matrix.python-version }}
          enable-cache: true

      - name: Test with python ${{ matrix.python-version }}
        run: uv run --frozen ruff check

      - name: Test with python ${{ matrix.python-version }}
        run: uv run --frozen pylint src/devops_final_backend

      - name: Test with python ${{ matrix.python-version }}
        run: uv run --frozen mypy .

      - name: Test with python ${{ matrix.python-version }}
        run: uv run --frozen pytest
        env:
          # this test env does contain dummy values as they are not used
          APP_NAME: "Devops Final Test"
          APP_VERSION: vNext
          DEBUG: true
          DISABLE_API_TESTING: false
          LLM_MODEL: llama3.1
          LLM_PROVIDER: ollama
          KEYCLOAK_URL: http://keycloak
          KEYCLOAK_REALM: realm
          KEYCLOAK_CLIENT_ID: app
          KEYCLOAK_CLIENT_SECRET: secret
          KEYCLOAK_TEST_USERNAME: streamlit-app
          KEYCLOAK_TEST_PASSWORD: streamlit-app
