repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # formatters
    -   id: trailing-whitespace
    -   id: end-of-file-fixer
    -   id: check-yaml
    -   id: check-added-large-files
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.3
    hooks:
      # formatters
      - id: ruff-check
        args: [ --fix ]
      - id: ruff-format
        files: ^src/.*\.py$
  - repo: local
    hooks:
      #  Tests
      - id: mypy
        name: mypy
        entry: uv run mypy .
        language: system
        types: [python]
        files: ^src/.*\.py$
        pass_filenames: false
      - id: pylint
        name: pylint
        entry: uv run pylint src/devops_final_backend
        language: system
        types: [python]
        files: ^src/.*\.py$
        require_serial: true
      - id: pytest
        name: Run pytest
        entry: bash -c 'export HYPOTHESIS_STORAGE_DIRECTORY=.cache/hypothesis && uv run pytest --import-mode=importlib'
        language: system
        types: [python]
        pass_filenames: false

      # Automated File Generators
      - id: export-requirements
        name: Export requirements.txt from uv
        entry: uv export -o requirements.txt --no-header --no-hashes
        language: system
        files: ^pyproject\.toml$
        pass_filenames: false
      - id: build-docs
        name: Build Sphinx Docs
        entry: ./scripts/build_docs.sh
        language: system
        pass_filenames: false

      # Clear leftovers from dev / testing
      - id: clean-caches
        name: Remove Python cache folders
        entry: ./scripts/clear_caches.sh
        language: system
        pass_filenames: false

# Hooks not yet used
      # - id: commit-msg-check
      #   name: Validate commit message format
      #   entry: bash -c "grep -qE '^feat|^fix|^docs|^chore' $1 || (echo 'Commit message must start with feat, fix, docs, or chore'; exit 1)"
      #   language: system
      #   stages: [commit-msg]
      #   pass_filenames: false

      # - id: docker-build
      #   name: Docker Build on Commit
      #   entry: docker build -t api .
      #   language: system
      #   pass_filenames: false
      #   files: ^(src/(?!.*__pycache__/).*\.(py|pyi)$|Dockerfile$)
